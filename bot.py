import telebot
import buttons
import database
import os
from ai import AIHelper, setup_ai_handlers
from dotenv import load_dotenv

load_dotenv()

BOT_TOKEN = os.getenv("BOT_TOKEN")
bot = telebot.TeleBot(BOT_TOKEN)
ADMIN_ID = os.getenv("ADMIN_ID")

with open('company_info.txt', 'r', encoding='utf-8') as file:
    company_info = file.read().strip()

ai_helper = AIHelper(company_info)

@bot.message_handler(commands=['start'])
def send_welcome(message):
    user_name = message.from_user.first_name
    user_id = message.from_user.id
    database.add_user_if_not_exists(user_id, message.from_user.username)
    
    welcome_text = (
        f"<b>Telegram-–±–æ—Ç—ã –∏ Mini Apps ‚Äì —Ç–≤–æ–π –±–∏–∑–Ω–µ—Å –Ω–∞ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–µ</b>\n\n"
        f"–ü—Ä–∏–≤–µ—Ç, {user_name}!\n\n"
        "–¢—ã –∑–Ω–∞–µ—à—å, –≥–¥–µ —Å–µ–π—á–∞—Å —Ç–≤–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã? –ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äì –≤ Telegram. –ò –º—ã –ø–æ–º–æ–∂–µ–º —Ç–µ–±–µ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Ç—É—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å –Ω–∞ –ø–æ–ª–Ω–æ–º –∞–≤—Ç–æ–º–∞—Ç–µüí∞\n\n"
        
        "<b>–ß—Ç–æ –º—ã –¥–µ–ª–∞–µ–º?</b>\n"
        "ü§ñTelegram –±–æ—Ç—ã ‚Äì –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–∫–∞–∑—ã 24/7, –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –±–µ—Ä—É—Ç –æ–ø–ª–∞—Ç—É,\n"
        "üì≤Telegram Mini Apps ‚Äì —É–¥–æ–±–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã –∏ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä—è–º–æ –≤ —Ç–µ–ª–µ–≥–µ (–±–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è!),\n"
        "üõ†–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Äì –ø–æ–¥–∫–ª—é—á–∏–º –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ, —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ç–≤–æ–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞: –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, CRM, AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ –¥—Ä —Å–µ—Ä–≤–∏—Å—ã!\n\n"
        
        "<b>–ü–æ—á–µ–º—É —ç—Ç–æ –≤—ã—Å—Ç—Ä–µ–ª–∏—Ç?</b>\n"
        "‚Äî –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–∫—É–ø–∞—é—Ç –≤ 3 –∫–ª–∏–∫–∞, –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞,\n"
        "‚Äî –¢—ã —ç–∫–æ–Ω–æ–º–∏—à—å –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–µ: –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤,\n"
        "‚Äî –ü—Ä–æ–¥–∞–∂–∏ —Ä–∞—Å—Ç—É—Ç –∑–∞ —Å—á–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–πüìä\n\n"
        
        "<b>–î–ª—è –∫–æ–≥–æ?</b>\n"
        "üî• –†–∏—Ç–µ–π–ª –∏ —Ä–µ—Å–µ–π–ª,\n"
        "üì¢ –ë–ª–æ–≥–µ—Ä—ã –∏ —ç–∫—Å–ø–µ—Ä—Ç—ã,\n"
        "üöÄ –°—Ç–∞—Ä—Ç–∞–ø—ã –∏ –º–∞–ª—ã–π –±–∏–∑–Ω–µ—Å,\n"
        "üíª –û–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å—ã –∏ SaaS,\n"
        "üéØ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã –∏ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã,\n"
        "üí∏ –§–∏–Ω—Ç–µ—Ö,\n"
        "üèÜ –ë–∏–∑–Ω–µ—Å, –≥–¥–µ –≤–∞–∂–µ–Ω —Å–µ—Ä–≤–∏—Å\n\n"
        
        "<b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</b>\n"
        "1. –û–±—Å—É–∂–¥–∞–µ–º —Ç–≤–æ–π –±–∏–∑–Ω–µ—Å –∏ —Ü–µ–ª–∏,\n"
        "2. –°–æ–∑–¥–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ –∑–∞ 1-2 –Ω–µ–¥–µ–ª–∏,\n"
        "3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ\n\n"
        
        "<b>–•–≤–∞—Ç–∏—Ç —Ç–µ—Ä—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤!</b>\n"
        "–ü–æ–ª—É—á–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∏ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥ —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç —É–∂–µ —Å–µ–≥–æ–¥–Ω—è‚òéÔ∏è\n\n"
        
        "<i>P.S. –ü–µ—Ä–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–∂–µ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü. Telegram ‚Äì –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä, –∞ —Ç–≤–æ–π –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª –ø—Ä–æ–¥–∞–∂. –ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –Ω–∞ 100%!</i>"
    )

    bot.send_message(
        message.chat.id,
        welcome_text,
        reply_markup=buttons.get_main_keyboard(),
        parse_mode='HTML'
    )

@bot.message_handler(func=lambda m: m.text == "–°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π")
def send_me(message):
    bot.send_message(message.chat.id, "–ù–∞–ø–∏—Å–∞—Ç—å –º–Ω–µ: https://t.me/matterrezza")

@bot.message_handler(func=lambda m: m.text == "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É")
def send_form(message):
    bot.send_message(
        message.chat.id,
        "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ",
        reply_markup=buttons.get_inline_keyboard()
    )
    
@bot.message_handler(func=lambda m: m.text == "–£—Å–ª—É–≥–∏")
def send_serv(message):
    bot.send_message(
        message.chat.id,
        "üëá <b>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:</b>",
        reply_markup=buttons.get_inline_menu(),
        parse_mode='HTML'
    )
    
@bot.callback_query_handler(func=lambda call: True)
def handle_services(call):
    if call.data == 'service_bots':
        text = """<b>ü§ñ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Telegram-–±–æ—Ç–æ–≤</b>

–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞:
‚Ä¢ –ü—Ä–∏–µ–º –∑–∞–∫–∞–∑–æ–≤ 24/7
‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏
‚Ä¢ –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
‚Ä¢ –ì–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∑–∞ 3-5 –¥–Ω–µ–π"""
        
    elif call.data == 'service_scripts':
        text = """<b>üêç Python-—Å–∫—Ä–∏–ø—Ç—ã</b>

–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ª—é–±—ã—Ö –∑–∞–¥–∞—á:
‚Ä¢ –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –∏ Excel
‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
‚Ä¢ –ë–æ—Ç—ã –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚Ä¢ –†–µ—à–µ–Ω–∏–µ –∑–∞ 1-3 –¥–Ω—è —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π"""
        
    elif call.data == 'service_crm':
        text = """<b>üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CRM</b>

–ù–∞—Å—Ç—Ä–æ–∏–º Bitrix24 –ø–æ–¥ –≤–∞—à –±–∏–∑–Ω–µ—Å:
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂ –∏ –∑–∞–¥–∞—á
‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∞–π—Ç–æ–º –∏ —Å–æ—Ü—Å–µ—Ç—è–º–∏
‚Ä¢ –í–æ—Ä–æ–Ω–∫–∏ –ø—Ä–æ–¥–∞–∂ –∏ CRM-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚Ä¢ –û–±—É—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π
‚Ä¢ –ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –∑–∞ 2-3 –¥–Ω—è"""
        
    elif call.data == 'service_miniapps':
        text = """<b>üì± Mini Apps</b>

–ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä—è–º–æ –≤ Telegram!
‚Ä¢ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã –±–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚Ä¢ –í 3 —Ä–∞–∑–∞ –¥–µ—à–µ–≤–ª–µ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚Ä¢ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ"""
        
    elif call.data == 'back_to_main':
        bot.edit_message_text(
            chat_id=call.message.chat.id,
            message_id=call.message.message_id,
            text="üëá <b>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:</b>",
            reply_markup=buttons.get_inline_menu(),
            parse_mode='HTML'
        )
        return
    
    bot.edit_message_text(
        chat_id=call.message.chat.id,
        message_id=call.message.message_id,
        text=text,
        reply_markup=buttons.get_back_button(),
        parse_mode='HTML'
    )

# –ü–æ–¥–∫–ª—é—á–∞–µ–º AI –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
setup_ai_handlers(bot, ai_helper)

if __name__ == '__main__':
    bot.polling(none_stop=True)
